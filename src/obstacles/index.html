<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 3</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
    <script src="Blackhole.js"></script>
    <script src="Player.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, });
    var player;
    var blackholes;

    function preload() {

        game.load.image('sky', 'assets/sky.png');
        game.load.image('ground', 'assets/platform.png');
        game.load.image('star', 'assets/star.png');
        game.load.image('blackhole', 'assets/blackhole.png');
        game.load.spritesheet('dude', 'assets/dude.png', 32, 48);

    }

    function create() {

        //  We're going to be using physics, so enable the Arcade Physics system
        game.physics.startSystem(Phaser.Physics.ARCADE);

        //  A simple background for our game
        game.add.sprite(0, 0, 'sky');

        blackholes = game.add.group();


        //  We will enable physics for any object that is created in this group
        world.enableBody = true;

        // Here we create the ground.
        var pos = Phaser.Point(150, 150);
        createBlackhole(pos);

        var spritePlayer = game.add.sprite(10, 10, 'star');
        player = new Player(new Phaser.Point(0, 1), spritePlayer);

        //  We need to enable physics on the player
        game.physics.arcade.enable(player);

    }

    function update() {

        game.physics.arcade.overlap(player, blackholes, hitBlackhole, null, this);
    }

    function hitBlackhole(player, blackhole) {

        var d = new Phaser.Point(blackhole.x - player.position.x, blackhole.y - player.position.y);
        console.log('vGravity: ' + d);
        var nd = normalize(d);
        console.log('vnGravity: ' + nd);
        var gravity = new Phaser.Point(nd.x * 1.3, nd.y * 1.3);

        player.velocity.x = gravity.x;
        player.velocity.y = gravity.y;
        console.log("interaction from blackhole");
    }

    function createBlackhole(position) {

        blackholes.create(position.x, position.y, 'blackhole');
    }

</script>

</body>
</html>